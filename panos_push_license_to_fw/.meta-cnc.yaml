name: push_license_files_to_fw
label: Push License Key to FW
description: |
    Push license keys to NGFW

type: panos

labels:
  collection: lib

variables:
  - name: TARGET_IP
    description: NGFW IP or Hostname
    default: 192.168.55.10
    type_hint: hidden
  - name: TARGET_USERNAME
    description: NGFW Username
    default: admin
    type_hint: hidden
  - name: TARGET_PASSWORD
    description: NGFW Password
    default: admin
    type_hint: hidden
  - name: key_list
    type_hint: hidden
-   name: key
    description: key
    type_hint: text
    default: fs6U28hkqfSdsLE8rYa2MLh66e23McCOBTI8olVYBl8X1b45vJeObuP2dKzmoOAc\nOVlUIBxGr8M3CWzyYkddltx4WhzMJybmw23A6VzlEqTroIZIDHXVIFJ09HHUABqe\nYv7exsRK+Nj7ubpptrlcE/c85JTmnXu/3KfHgXKM08R7v2OMSsX8TxQdoLFnwRlx\nkCl0J5cp5XlGkJZ4dKeorOzFlbQ6BnvtkUXWn/zc0ngGwytNkyvXyJjW8WmDpm4I\nNz2QuYCROGXaWC+2Nl4tI9U5JUf/hQa3pVhwZ2J8DFXsoloGz+mbpnIaQjxrYCsw\njSitkbByNNRNLRxOReAwsw==\n
    help_text: ''

snippets:
  - name: format_key
    cmd: parse
    variable: key
    outputs:
      - name: formatted_key
        capture_variable: {{ key | replace('\\n', '\n') }}

  - name: push_to_fw
    cmd: op
    cmd_str: <request><license><install>{{ formatted_key }}</install></license></request>

#  - name: push_command_to_fw
#    cmd: op
#    cmd_str: <request><license><install>{{ loop | replace('\n', '') -}}</install></license></request>
#    loop: key_list